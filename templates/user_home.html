<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>아름다운가게 홈</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #fffaf3;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: auto;
      width: 100%;
      max-width: 100vw;
    }
    .top-bar {
      background-color: #d88f30;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 12px 24px;
      position: relative;
    }
    .logo {
      font-size: 1.2em;
      font-weight: bold;
    }
    .user-info-box {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      margin-top: 2px;
    }
    .user-name {
      font-size: 0.95em;
      font-weight: bold;
      color: white;
    }
    .clock-box {
      background-color: #fff3e0;
      color: #5a4031;
      padding: 6px 14px;
      border-radius: 14px;
      font-size: 1em;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      border: 1px solid #ffd54f;
      font-family: 'Segoe UI', sans-serif;
      transition: background-color 0.3s ease;
    }
    .clock-box.blink {
      background-color: #ffe0b2;
    }
    .content {
      display: flex;
      flex-direction: row;
      padding: 20px 30px;
      gap: 30px;
      flex: 1;
      overflow: visible;
    }
    .left-panel {
      flex: 0.9;
      padding: 30px;
      overflow-y: auto;
    }
    .right-panel {
      flex: 1;
      padding: 30px 20px 30px 0;
      overflow-y: auto;
    }
    .section {
      background-color: white;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid #f2e0c0;
      padding: 24px;
      margin-bottom: 30px;
      transition: box-shadow 0.2s ease, transform 0.2s ease;
    }
    .order-history-entry {
      padding: 4px 0;
      font-size: 0.95em;
      color: #444;
    }
    .footer {
      text-align: center;
      font-size: 0.9em;
      color: #888;
      margin-top: 30px;
    }
    .logout-button {
      background-color: #fff3e0;
      color: #5a4031;
      font-weight: bold;
      padding: 6px 12px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: background 0.2s;
    }
    .logout-button:hover {
      background-color: #ffe0b2;
    }
  </style>
</head>
<body>
<div class="top-bar">
  <div class="logo">아름다운가게</div>
  <div class="user-info-box">
    <div class="user-name">{{ store_name }}님 어서오세요</div>
    <div style="display: flex; gap: 10px; align-items: center;">
      <div id="clock" class="clock-box">--:--:--</div>
      <a href="{{ url_for('logout') }}">
        <button class="logout-button">로그아웃</button>
      </a>
    </div>
  </div>
</div>
<div class="content">
  <div class="left-panel">
    <div class="section">
      <h2>🧸 상품 둘러보기
        <a href="{{ url_for('user_request_form') }}">
          <button class="btn-see-all">+ 더보기</button>
        </a>
      </h2>
      <div class="item-list" style="display: flex; flex-wrap: wrap; gap: 18px;">
        {% for item in items[:8] %}
        <div class="item-card">
          <div class="image-container">
            <img src="{{ item.image_url }}" alt="상품 이미지">
            <button class="zoom-button" onclick="zoomImage('{{ item.image_url }}')">🔍</button>
          </div>
          <h3>{{ item.name }}</h3>
          <p><strong>생산단가:</strong> {{ item.price | int }}원</p>
          <div class="quantity-submit">
            <input type="number" id="quantity-{{ item.id }}" min="1" value="1">
            <button class="custom-request-btn" onclick="submitRequestDirect('{{ item.id }}')">🛒 담기</button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    <div class="section">
      <h2>🐻 비품 요청/접수
        <a href="/user/equipments">
          <button class="btn-see-all">+ 더보기</button>
        </a>
      </h2>
      <div style="display: flex; flex-wrap: wrap; gap: 18px;">
        {% for e in equipments[:4] %}
        <div style="width: 160px; padding: 10px; background: white; border-radius: 10px; box-shadow: 0 2px 8px #eee;">
          <div style="text-align: center;">
            {% if e[4] %}<img src="/static/uploads/{{ e[4] }}" width="120" height="120" style="object-fit: cover; border-radius: 8px;">{% endif %}
            <p><strong>{{ e[1] }}</strong></p>
            <p style="font-size: 0.9em; color: #444;">단가: {{ e[2] }}원</p>
          </div>
          <div style="display: flex; justify-content: center; align-items: center; margin-top: 6px;">
            <input type="number" id="quantity_{{ e[0] }}" min="1" value="1" style="width: 50px; margin-right: 4px;">
            <button onclick="submitEquipmentRequest({{ e[0] }})" style="padding: 4px 10px; background: #ffcc80; border: none; border-radius: 6px;">신청</button>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    <div class="section">
      <h2>📢 공지사항</h2>
      <div style="display:flex; gap:16px; flex-wrap: wrap;">
        {% for notice in notices[:3] %}
        <div onclick="showNotice('{{ notice[0] }}')" class="notice-entry">
          {% if notice[2] %}
          <img src="{{ url_for('static', filename='uploads/' + notice[2]) }}" width="100">
          {% endif %}
          <p><strong>{{ notice[1] }}</strong></p>
          <small>{{ notice[3].strftime('%Y-%m-%d') }}</small>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="right-panel">
    <div class="section">
      <h2>📦 입고 일정
        <a href="{{ url_for('user_schedule') }}">
          <button class="btn-see-all">전체 보기</button>
        </a>
      </h2>
      {% for s in schedule %}
        <div>{{ s.delivery_date }} | {{ s.name }} | {{ s.quantity }}개 | 배송중 🚚</div>
      {% else %}
        <div>📬 예정된 입고 일정이 없습니다.</div>
      {% endfor %}
    </div>
    <div class="section">
      <h2>📁 주문 이력
        <a href="{{ url_for('user_orders') }}">
          <button class="btn-see-all">+ 더보기</button>
        </a>
      </h2>
      {% for order in recent_orders %}
        <div class="order-history-entry">
          {{ order.order_date }} | {{ order.name }} {{ order.quantity }}개
        </div>
      {% else %}
        <div class="order-history-entry">주문 내역이 없습니다.</div>
      {% endfor %}
    </div>
    <div class="footer">릴라스테이션 ©2025 Created by carrot0217</div>
  </div>
</div>
<script>
function updateClock() {
  const now = new Date();
  const dateStr = now.toLocaleDateString('ko-KR', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit'
  });
  const timeStr = now.toLocaleTimeString('ko-KR', {
    hour12: false,
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
  const clock = document.getElementById("clock");
  clock.textContent = `${dateStr} ${timeStr}`;
  clock.classList.add("blink");
  setTimeout(() => clock.classList.remove("blink"), 200);
}
setInterval(updateClock, 1000);
updateClock();

// 쪽지 버튼 삽입 복구
window.addEventListener('DOMContentLoaded', () => {
  const messageButton = document.createElement('button');
  messageButton.innerHTML = '📬 쪽지함';
  messageButton.className = 'logout-button';
  messageButton.style.backgroundColor = '#ffcc80';
  messageButton.style.fontWeight = 'bold';
  messageButton.style.marginTop = '6px';
  messageButton.onclick = function () {
    window.location.href = "/user/messages";
  };
  const target = document.querySelector('.user-info-box > div');
  if (target) target.insertBefore(messageButton, target.children[1]);
});
</script>
</body>
</html>
